= 実装サンプル）単純計算アプリケーション

https://github.com/totheralistair/SmallerWebHexagon[Smaller Web Hexagon] に
記載されているサンプルを一部改造しつつ Java で実装する。

入力値に対して対応するレートを使った計算を行い、計算結果と使用したレートを返却するアプリケーション

== システム概要図


== ユースケース

参考にした作成方法 : https://qiita.com/putan/items/580cbc6f136859f82edb[Quiita, ユースケースをモデリングする]

https://it-koala.com/usecasediagrams-1832

include::usecases.adoc[]



概要ユースケース図


詳細ユースケース図


== 設計

コアとなるレイヤーから設計していく。

=== 全体像

++++
<div class="mermaid">
classDiagram
direction LR
include::uml/class_domain01.uml[]
include::uml/class_appservice.uml[]
include::uml/class_primary_adapter.uml[]
include::uml/class_secondary_adapter.uml[]

</div>
++++



=== ドメインレイヤー

入力値に対して対応するレートを使った計算を行い、計算結果と使用レートを返却する。


クラス図


++++
<div class="mermaid">
classDiagram
direction LR
include::uml/class_domain01.uml[]
</div>
++++

入力値などもモデリングが必要で値オブジェクトとする場合は以下のような集約やコンポジションとなる。
（より複雑なパターンとして他のサンプルで例を示す予定）

++++
<div class="mermaid">
include::uml/class02.uml[]
</div>
++++




シーケンス図

++++
<div class="mermaid">
include::uml/sequence.uml[]
</div>
++++


==== オブジェクト


===== エンティティ

レート
id は入力値
レート値

制約がゆるく値オブジェクトとしてモデリングは行わず、データ型（言語に用意されているプリミティブ型や列挙型など）で十分な属性の
例として、ここではレート値については値オブジェクトにしない。
＝＞ドメインモデルの説明で UML の例を挙げれば十分なのでここでは全て値オブジェクトにする？


.エンティティ一覧
[cols="1,1,1"options="header,autowidth",stripes=hover]
|===
| 名前 |プライマリアクター

|===


.レート詳細
[cols="1,1,1,1,2"options="header,autowidth",stripes=hover]
|===
| 名前 | 種別 | 可視性 | 詳細 | 説明

|id
|属性
|private
|id : 計算入力値
a|レート値を決定する ID 。ここでは計算の入力値を利用する。

|data
|属性
|private
|rate : double
a|レート値

|生成
|操作
|public
|生成(id : 計算入力値, rate : double) : レート
a|本エンティティの生成操作
|===


.サンプルソース（ Java ）：レート
[source,java]
----
include::src/sampleapp/src/main/java/sample/application/domain/object/entity/RateEntity.java[]
----


===== 値オブジェクト

できれば抽象クラスとして値オブジェクトクラスを作って継承させたいが、ややこしいため今回は保留

計算入力値


計算結果値



値
制約チェック



==== サービス

プライマリポートのインターフェース

計算実行
入力 入力値
出力 計算結果値




==== ライフサイクル

エンティティに対するライフサイクルパターン


集約

集約ルート
レート



リポジトリ
レート


== アプリケーションレイヤー



ポート 2 つだけの単純な構造


コンテキストは 1 つとする。








サービスとプライマリポートの扱いは調査中

サービスにポートとなるインターフェースとその実装の両方を含める？

=== サービス

ユースケースに応じてプライマリポートとセカンダリポートを繋げる役割を持つ。

プライマリポートの実装
セカンダリポートの呼び出し



=== ポート

ポートは入出力を定義
入出力はリクエストとレスポンス
レスポンスは結果そのものだけではなく、正常異常のステータスも必須

==== プライマリポート

ユーザサイドポート

入力値を受け取って計算結果とレートを返す。

DDD としての役割 サービス？
Java としての実装 インターフェース




==== セカンダリポート

データサイドポート

入力値を元にレートを取得

DDD におけるリポジトリ

インターフェースとして実装

DDD としての役割 リポジトリ
Java としての実装 インターフェース







== アダプタ

プライマリアダプタ
CUI アダプタ
HTTP アダプタ
テストアダプタ

セカンダリアダプタ
モック（インメモリ）アダプタ
ファイルシステムアダプタ


ポートの実装として実装


== アクター



プライマリアクター
ユーザ（人）
HTTP リクエスト
テストスクリプト


セカンダリアクター
モック（インメモリ）
ファイルシステム
DBMS







== ディレクトリ構成

レイヤーで記載した分類に合わせる。












